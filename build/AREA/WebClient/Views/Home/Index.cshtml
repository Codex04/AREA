@using WebClient.Models;
@using System.Security.Claims;

@model IndexViewModel

@{
    ViewBag.Title = "Index";
}

<div class="mainContainer">
    <aside class="sidebar">
        <menu class="profileActions">
            @{
                if (Request.IsAuthenticated)
                {
                    var claimId = User.Identity as ClaimsIdentity;
                    if (claimId != null)
                    {
                        <p class="profileName">@claimId.FindFirst(ClaimTypes.NameIdentifier).Value</p>
                    }
                }
            }
            <div class="logoutLabelContainer">
                <span>
                    @using (Html.BeginForm("AddArea", "Home", Model))
                    {
                        <button type="submit" style="float: left">Add a new AREA</button>
                    }
                </span>
                <span class="logoutLabel"><i class="fa fa-sign-out" aria-hidden="true"></i> 
                    <span>@Html.ActionLink("Logout", "Logout", "Auth", null, new { @class = "logoutLabel" })</span>
                </span>
            </div>
        </menu>
        <section class="sidebarItemsContainer">
            <script type="text/javascript">
                initTreeData(@Model.Areas.Count);
            </script>
            @for (int i = 0; i < @Model.Areas.Count; i++)
            {
                <div class="sidebarItem" id="sidebarItem@(i)">
                    <script type="text/javascript">
                        var itemIndex = -1;

                        function GetSelectedSideItemIndex() {
                            return (itemIndex);
                        }

                        var arr = '@Html.Raw(Model.Areas)'
                        $("#sidebarItem@(i)").click(function () {
                            for (var j = 0; j < arr.length; j++)
                                $("#sidebarItem" + j.toString()).removeClass("selectedItem")
                            @for (int k = 0; k < @Model.Areas.Count; k++)
                            {
                                if (i != k)
                                {
                                    Model.Areas[k].IsSelected = false;
                                }
                                else
                                {
                                    Model.Areas[k].IsSelected = true;
                                }

                            }
                            itemIndex = @(i);
                            $("#sidebarItem@(i)").addClass("selectedItem")
                            setTreeData(getTree(itemIndex))
                            drawTreeData();
                        });
                    </script>
                    <p>@Model.Areas[i].Name</p>
                </div>
            }
        </section>
    </aside>
    <section id="canvasContainer" class="canvasContainer" onresize="resizeCanvasToSquare()">
        <canvas id="canvasTree"></canvas>
        <script type="text/javascript" src="~/Scripts/CanvasDrawing.js"></script>
        <script type="text/javascript" src="~/Scripts/CanvasEvents.js"></script>
    </section>
</div>
